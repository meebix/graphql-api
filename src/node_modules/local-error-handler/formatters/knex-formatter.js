const objectPath = require('object-path');

/**
 * Format the error according to Knex
 *
 * @function
 * @param {Object} err - Error thrown from controller
 * @returns {Object} - Formatted error object to be passed to formatError
 */
function knexError(err) {
  // Set a default properties
  const statusCode = '400';
  const code = objectPath.get(err, 'code', 'KNEX_ERROR');
  const errno = objectPath.get(err, 'errno', undefined);

  // Defaults are set to fit the majority of use cases
  const error = {
    level: 'warn',
    message: err.sqlMessage,
    statusCode,
    jsonResponse: [{
      statusCode,
      message: err.sqlMessage,
      code,
      meta: { errno },
    }],
  };

  return error;
}

module.exports = knexError;
